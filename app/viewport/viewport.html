<section class = "filters" cv-each = "effects:effect">[[effect]]</section>

<div class = "viewport-frame [[initializing]] [[standalone]] [[secret]]" cv-ref = "frame">
	<div class = "viewport-header">
		<span class = "sean-icon"></span>
		<h1>Pixel Physics</h1>
	</div>
	<div class = "viewport [[standalone]] [[fullscreen]]" cv-ref = "viewport" tabindex="0" cv-on = "click(event)">

		<svg>
		<defs>

			<filter id="motionBlur">
				<feGaussianBlur in="SourceGraphic" stdDeviation="0" cv-ref = "blur" />
			</filter>

			<filter
				color-interpolation-filters="sRGB"
				id = "waves"
				x      ="0%"
				y      ="0%"
				height ="100%"
				width  ="100%"
			>
				<feFlood flood-color="#408000" result = "DisplacementGreen" />

				<feImage
					xlink:href="/effects/wave.png"
					result="DisplacementSource"
					height="64"
					width="64"
				/>

				<feTile
					in="DisplacementSource"
					result="DisplacementTile"
				>

				</feTile>

				<feComposite
					in  = "DisplacementTile"
					in2 = "DisplacementGreen"
					result ="DisplacementField"
					operator ="over"
				>

				</feComposite>

				<feOffset
					in  = "DisplacementField"
					out = "DisplacementOffset"
					dx  = "0"
				>
					<animate
						attributeName="dy"
						values = "0;-64"
						dur="2s"
						repeatCount="indefinite" />

				</feOffset>


				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementOffset"
					result="Displaced"
					xChannelSelector="R"
					yChannelSelector="G"
					scale="4"
				/>

				<feGaussianBlur
					in="Displaced"
					stdDeviation="0.35"
				/>

			</filter>

			<!-- <filter
				color-interpolation-filters="sRGB"
				id = "twist"
				x      ="-0%"
				y      ="0%"
				height ="100%"
				width  ="100%"
			>
				<feImage
					xlink:href="/effects/twist.png"
					result="DisplacementSource"
					height="64"
					width="64"
				/>
				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementSource"
					xChannelSelector="R"
					yChannelSelector="G"
					scale="10"
				/>

			</filter> -->

			<!-- <filter
				color-interpolation-filters="sRGB"
				id = "pinch"
				x      ="-0%"
				y      ="0%"
				height ="100%"
				width  ="100%"
			>
				<feImage
					xlink:href="/effects/pinch.png"
					result="DisplacementSource"
					height="64"
					width="64"
				/>
				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementSource"
					xChannelSelector="R"
					yChannelSelector="G"
					scale="30"
				/>

			</filter>

			<filter
				color-interpolation-filters="sRGB"
				id = "unpinch"
				x      ="-0%"
				y      ="0%"
				height ="100%"
				width  ="100%"
			>
				<feImage
					xlink:href="/effects/pinch.png"
					result="DisplacementSource"
					height="64"
					width="64"
				/>
				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementSource"
					xChannelSelector="R"
					yChannelSelector="G"
					scale="-30"
				/>

			</filter> -->
		</defs>
		</svg>

		<div class = "viewport-zoom">

			[[backdrop]]

			<div class = "blurAngle" cv-ref = "blurAngle">
			<div class = "blurDistance" cv-ref = "blurDistance">
			<div class = "blurAngleCancel" cv-ref = "blurAngleCancel">
				<div
					cv-ref  = "background"
					class   = "viewport-bg-layers"
					cv-each = "layers:layer"
				>[[layer]]</div>
			</div>
			</div>
			</div>

			<div class = "filters filters-background" cv-ref = "bgFilters"></div>

			<div cv-ref = "content" class = "viewport-content">

				<div cv-ref = "actors" class = "viewport-actors">[[actor]]</div>

				<div cv-ref = "particles" class = "viewport-particles" cv-each = "particles:particle:p">[[particle]]</div>

 			</div>
 		</div>

 		<div class = "viewport-overlay">
			<div class = "hud">
				<table>

					<!-- <tr>
						<td colspan = "2">[[char]]</td>
					</tr>

					<tr>
						<td>[[labelGround]]</td>
						<td>[[ground]]</td>
					</tr>

					<tr>
						<td>[[labelMode]]</td>
						<td>[[mode]]</td>
					</tr>

					<tr>
						<td>[[labelX]]</td>
						<td>[[xPos]]</td>
					</tr>

					<tr>
						<td>[[labelY]]</td>
						<td>[[yPos]]</td>
					</tr>

					<tr>
						<td>[[labelXSpeed]]</td>
						<td>[[xSpeed]]</td>
					</tr>

					<tr>
						<td>[[labelYSpeed]]</td>
						<td>[[ySpeed]]</td>
					</tr>

					<tr>
						<td>[[labelAirAngle]]</td>
						<td>[[airAngle]]</td>
					</tr>

					<tr>
						<td>[[labelAngle]]</td>
						<td>[[angle]]</td>
					</tr>

					<tr>
						<td>[[labelFrame]]</td>
						<td>[[frame]]</td>
					</tr> -->

					<!-- <tr>
						<td>[[labelFps]]</td>
						<td>[[fpsSprite]]</td>
					</tr> -->

					<!-- <tr>
						<td>[[labelGSpeed]]</td>
						<td>[[gSpeed]]</td>
					</tr> -->

				</table>
			</div>

			<div class = "hud hud-dark hud-top-right">
				<div class = "char-hud">
					[[char]]
					<div class = "char-icon [[charName]]"></div>
				</div>
			</div>

			<div class = "hud hud-dark hud-bottom-right">
				<table><tr>
					<td>[[labelFps]]</td>
					<td>[[fpsSprite]]</td>
				</tr></table>
			</div>

			<div class = "hud hud-dark hud-bottom-left">
				[[nowPlaying]]
				[[trackName]]
			</div>

			<div class = "filters filters-foreground" cv-ref = "fgFilters"></div>

			<div class = "hud hud-top-left">
				<div class = "timer">[[timer]]</div>
				<div cv-if = "hasRings">[[rings]]</div>
				<div cv-if = "hasCoins">[[coins]]</div>
				<div cv-if = "hasEmeralds">[[emeralds]]</div>
			</div>

			[[titlecard]]

			<div class = "topLine">
				<div class = "status-message">[[topLine]]</div>
			</div>

			<div class = "focus-me">
				<div class = "status-message">[[focusMe]]</div>
			</div>

			<div class = "status-message">[[status]]</div>

			<div class = "console" cv-ref = "subspace">[[subspace]]</div>

		</div>

		<div class = "quick-controls">

			[[muteSwitch]]

			<div class = "button" cv-on = "click:fullscreen()">
				<image src = "/ui/fullscreen.svg" />
			</div>

		</div>


	</div>

	<div class = "viewport-caption [[inputType]]">

		<div class = "top-bar">

			<div class = "buttons">

				<button cv-on = "click:fullscreen(event)">fullscreen</button>

				<span cv-if = "!isRecording">
					<span cv-if = "!isReplaying">
						<button cv-on = "click:reset(event)">reset</button>
						<button cv-on = "click:record(event)">record</button>
						<span cv-if = "hasRecording">
							<button cv-on = "click:playback(event)">playback</button>
						</span>
					</span>
				</span>

				<span cv-if = "isReplaying">
					<button cv-on = "click:stop(event)">stop</button>
				</span>

				<span cv-if = "isRecording">
					<button cv-on = "click:stop(event)">stop</button>
				</span>

			</div>

			<a class = "github" cv-link = "https://github.com/seanmorris/pixel-physics">
				<span class = "github-icon"></span>
				view the project on github
			</a>

			<label class = "change-character">

				change character:

				<select cv-each = "controllable:obj:name" cv-ref = "currentActor" cv-on = "change(event)">
					<option value = "[[name]]">[[name]]</option>
				</select>

			</label>

		</div>

		<div>

			<div>
				<b>controls: [[inputName]]</b> [[controlCard]]
			</div>

			<div>
				<b>moves:</b> [[moveCard]]
			</div>

			<div class = "right">

				<b>options:</b>

				<label>
					<span>enable audio</span>
					<input type = "checkbox" cv-bind = "audio" value = "1" />
				</label>

				<label>
					<span>max fps</span>
					<input type = "number" cv-bind = "maxFps" value = "100" />
				</label>

				<label>
					<span>scale:</span>
					<form>
						<input type = "number" cv-bind = "scale" min = "1" max = "5" />
					</form>
				</label>

			</div>
		</div>
	</div>

</div>




<div class = "sun"></div>
<div class = "clouds-a"></div>
<div class = "clouds-b"></div>

