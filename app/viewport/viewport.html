<section class = "filters" cv-each = "effects:effect">[[effect]]</section>

<div class = "viewport-frame [[initializing]] [[standalone]] [[secret]] [[level]] [[noIntro]] [[inputType]]" cv-ref = "frame">
	<div class = "viewport-header">
		<span class = "sean-icon"></span>
		<h1>Pixel Physics</h1>
	</div>
	<div class = "viewport [[standalone]] [[fullscreen]] displacement-[[displacement]] mouse-[[mouse]] [[theme]]" cv-ref = "viewport" tabindex="0" cv-on = "click(event);mousemove(event)">

		<svg height="100" width="100">
		<defs>

			<filter id="motionBlur">
				<feGaussianBlur in="SourceGraphic" stdDeviation="0" cv-ref = "blur" />
			</filter>

			<filter id="dilate">
				<feMorphology operator="dilate" radius="0.25" result = "expanded"/>
				<feMerge>
					<feMergeNode in="expanded" />
					<feMergeNode in="SourceGraphic" />
				</feMerge>
			</filter>

			<filter id = "waves"
				color-interpolation-filters="sRGB"
				x      ="0%"
				y      ="0%"
				height ="100%"
				width  ="100%"
			>
				<feFlood
					flood-color="#408000"
					result = "DisplacementGreen"
				></feFlood>

				<feImage
					xlink:href="/effects/wave.png"
					result="DisplacementSource"
					height="64"
					width="64"
				></feImage>

				<feTile
					in="DisplacementSource"
					result="DisplacementTile"
				></feTile>

				<feComposite
					in  = "DisplacementTile"
					in2 = "DisplacementGreen"
					result ="DisplacementField"
					operator ="over"
				></feComposite>

				<feOffset
					in  = "DisplacementField"
					out = "DisplacementOffset"
					dx  = "0"
				>
					<animate
						attributeName="dy"
						values = "0;-64"
						dur="1500ms"
						repeatCount="indefinite" />

				</feOffset>

				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementOffset"
					result="Displaced"
					xChannelSelector="R"
					yChannelSelector="G"
					scale="4"
				></feDisplacementMap>

				<feGaussianBlur
					in="Displaced"
					stdDeviation="0.35"
				></feGaussianBlur>

			</filter>

			<filter id = "ntsc"
				color-interpolation-filters="sRGB"
				x      = "0%"
				y      = "0%"
				width  = "100%"
				height = "200%"
			>
				<feFlood
					flood-color="#808000"
					result = "DisplacementGreen"
				></feFlood>

				<feImage
					xlink:href="/effects/ntsc-static.png"
					result ="DisplacementSource"
					width  = "128"
					height = "128"
				></feImage>

				<feTile
					in="DisplacementSource"
					result="DisplacementTile"
				></feTile>

				<feComposite
					in  = "DisplacementTile"
					in2 = "DisplacementGreen"
					result ="DisplacementField"
					operator ="over"
				></feComposite>

				<feOffset
					in  = "DisplacementField"
					out = "DisplacementOffset"
					dx  = "0"
					dy  = "0"
				>
					<animate
						attributeName="dy"
						values = "-128;0"
						dur="2000ms"
						repeatCount="8"
					></animate>

				</feOffset>

				<feDisplacementMap
					in="SourceGraphic"
					in2="DisplacementOffset"
					result="Displaced"
					xChannelSelector="R"
					yChannelSelector="G"
					scale = "0"
				>
					<animate
						attributeName="scale"
						values = "512;192;0"
						dur="2000ms"
						repeatCount="1"
					></animate>

				</feDisplacementMap>

			</filter>

		</defs>
		</svg>

		<div class = "viewport-zoom">

			[[backdrop]]

			<div class = "backdrops" cv-ref ="backdrops"></div>

			<div class = "blurAngle" cv-ref = "blurAngle">
			<div class = "blurDistance" cv-ref = "blurDistance">
			<div class = "blurAngleCancel" cv-ref = "blurAngleCancel">
				<div
					cv-ref  = "background"
					class   = "viewport-bg-layers"
					cv-each = "layers:layer"
				>[[layer]]</div>
			</div>
			</div>
			</div>

			<div class = "filters filters-background" cv-ref = "bgFilters"></div>

			<div cv-ref = "content" class = "viewport-content">
				<div cv-ref = "actors" class = "viewport-actors"></div>
				<div cv-ref = "particles" class = "viewport-particles"></div>
 			</div>

 			<div cv-ref = "regionBox" class = "viewport-content">
 				<div cv-ref = "regions" class = "viewport-actors"></div>
 			</div>

			<div class = "blurAngle" cv-ref = "blurAngleFg">
			<div class = "blurDistance" cv-ref = "blurDistanceFg">
 			<div class = "blurAngleCancel" cv-ref = "blurAngleCancelFg">
				<div
					cv-ref  = "foreground"
					class   = "viewport-bg-layers"
					cv-each = "fgLayers:layer"
				>[[layer]]</div>
			</div>
			</div>
			</div>
 		</div>

 		<div class = "viewport-overlay">
			<div class = "hud hud-top-right hud-table"  cv-if = "debugOsd">
				<table>

					<tr>
						<td colspan = "2">[[char]]</td>
					</tr>

					<tr>
						<td>[[labelGround]]</td>
						<td>[[ground]]</td>
					</tr>

					<tr>
						<td>[[labelMode]]</td>
						<td>[[mode]]</td>
					</tr>

					<tr>
						<td>[[labelX]]</td>
						<td>[[xPos]]</td>
					</tr>

					<tr>
						<td>[[labelY]]</td>
						<td>[[yPos]]</td>
					</tr>

					<tr>
						<td>[[labelGSpeed]]</td>
						<td>[[gSpeed]]</td>
					</tr>

					<tr>
						<td>[[labelXSpeed]]</td>
						<td>[[xSpeed]]</td>
					</tr>

					<tr>
						<td>[[labelYSpeed]]</td>
						<td>[[ySpeed]]</td>
					</tr>

					<tr>
						<td>[[labelAirAngle]]</td>
						<td>[[airAngle]]</td>
					</tr>

					<tr>
						<td>[[labelAngle]]</td>
						<td>[[angle]]</td>
					</tr>

					<tr>
						<td>[[labelFrame]]</td>
						<td>[[frame]]</td>
					</tr>

				</table>
			</div>

			<div class = "hud hud-top-right" cv-if = "showHud">

				<div class = "char-hud">
					[[char]]
					<div class = "char-icon [[charName|hyphenate]]"></div>
				</div>

			</div>

			<div class = "hud hud-bottom-right" cv-if = "showHud">

				<div class ="sheild-hud [[currentSheild]] [[hasElectric]] [[hasFire]] [[hasWater]]">
					<div class = "sheild-icon sheild-electric"></div>
					<div class = "sheild-icon spacer"></div>
					<div class = "sheild-icon sheild-fire"></div>
					<div class = "sheild-icon sheild-water"></div>
				</div>

				<span class = "contents" cv-if = "showFps">
					<table>
						<tr>
							<td>[[labelFps]]</td>
							<td>[[fpsSprite]]</td>
						</tr>
					</table>
				</span>
			</div>

			<div class = "hud hud-dark hud-bottom-left" cv-if = "showHud">
				[[nowPlaying]]
				[[trackName]]
			</div>

			<div class = "hud hud-top-left"  cv-if = "showHud">
				<div>[[scoreLabel]] [[score]]</div>
				<div>[[timerLabel]] [[timer]]</div>
				<div>[[ringLabel]] [[rings]]</div>
			</div>

			<div class = "hud hud-dark hud-centered" cv-if = "actClear">
				<table>
					<tr><td colspan="2">
						<div class = "centered">[[actClearLabel]]</div>
					</td></tr>
					<tr>
						<td>[[timeBonusLabel]]</td>
						<td>[[timeBonus]]</td>
					</tr>
					<tr>
						<td>[[ringBonusLabel]]</td>
						<td>[[ringBonus]]</td>
					</tr>
					<!-- <tr>
						<td>[[perfectBonusLabel]]</td>
						<td>[[perfectBonus]]</td>
					</tr> -->
					<tr>
						<td>[[speedBonusLabel]]</td>
						<td>[[speedBonus]]</td>
					</tr>
					<tr>
						<td>[[totalBonusLabel]]</td>
						<td>[[totalBonus]]</td>
					</tr>
				</table>
			</div>

			<section class = "full" cv-if = "paused">[[pauseMenu]]</section>

			[[titlecard]]

			<div class = "topLine">
				<div class = "status-message">[[topLine]]</div>
			</div>

			<div class = "focus-me">
				<div class = "status-message">[[focusMe]]</div>
			</div>

			<div class = "status-message">[[status]]</div>

			<section class = "contents" cv-if = "networked">[[chatBox]]</section>

			<!-- <div class = "filters filters-foreground" cv-ref = "fgFilters"></div> -->

			<div class = "console [[showConsole]]" cv-ref = "subspace" tab-index = "0">[[subspace]]</div>

			<div class = "shade" data-fade = "[[fade]]"></div>

		</div>

		<div class = "quick-controls" cv-if = "shortcuts">

			[[muteSwitch]]

			<div class = "button" cv-on = "click:fullscreen()">
				<image src = "/ui/fullscreen.svg" />
			</div>

		</div>


	</div>

</div>
